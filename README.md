# Greenhouse Control System | 智能大棚监控系统

本项目是一个基于 **STM32F103C8T6** 和 **ESP32** 双主控架构的智能大棚监控系统。它集成了多种环境传感器、执行器以及远程 Web 监控功能，旨在提供一套完整的温室自动化管理解决方案。

---

## 🌟 项目亮点

- **双核架构**：STM32 负责高实时的传感器采集与本地控制，ESP32 负责 WiFi 连接与 Web 服务。
- **本地显示**：2.42 英寸大尺寸 OLED 屏幕，采用优化的双列布局显示实时数据。
- **智能联动**：支持自动/手动双模式，根据环境阈值自动触发加湿、通风和遮阳逻辑。
- **远程操控**：响应式 Web 控制面板，支持手机/PC 实时查看数据并控制电机、风扇等设备。
- **稳健通信**：采用自定义串口协议实现双 MCU 之间的数据同步与指令确认（ACK 机制）。

---

## 🛠️ 硬件清单

| 类别 | 组件名称 | 型号/规格 | 描述 |
| :--- | :--- | :--- | :--- |
| **主控器** | STM32 | STM32F103C8T6 | 核心控制逻辑、传感器采集 |
| | ESP32 | ESP32-WROOM-32 | WiFi 联网、Web 服务器 |
| **传感器** | 温湿度 | DHT11 | 监测空气温度与湿度 |
| | 光照强度 | 光敏电阻模块 | 监测环境光照百分比 |
| | 二氧化碳 | JW01 | 监测 CO2 浓度 (ppm) |
| **执行器** | 步进电机 | 28BYJ-48 + ULN2003 | 模拟通风窗或遮阳帘控制 |
| | 舵机 | SG90 | 模拟自动门或精密调节阀 |
| | 直流风扇 | 5V/12V 风扇 | 散热通风 |
| | 加湿器 | 超声波加湿模组 | 湿度补偿 |
| **交互/显示** | OLED 屏幕 | 2.42" (SPI 接口) | 本地状态显示 |
| | 按钮 | 4 脚轻触开关 | 模式切换/本地手动控制 |

---

## 📐 硬件接线指南

### 1. 核心间通信 (STM32 <-> ESP32)
| STM32 引脚 | ESP32 引脚 | 描述 |
| :--- | :--- | :--- |
| PA9 (TX1) | GPIO16 (RX2) | 指令/数据传输 |
| PA10 (RX1) | GPIO17 (TX2) | 状态回传/ACK |
| GND | GND | 共地 (必须连接) |

### 2. STM32 传感器/执行器接线
- **OLED (SPI)**: D0-PA0, D1-PA1, RES-PA2, DC-PA3, CS-PA4
- **DHT11**: PA11
- **光照传感器**: PA5 (ADC)
- **JW01 (CO2)**: PB10/PB11 (USART3)
- **步进电机 (ULN2003)**: PB12, PB13, PB14, PB15
- **SG90 舵机**: PA7 (TIM3 CH2)
- **风扇 (Fan)**: PB1
- **加湿器 (Humidifier)**: PB0
- **本地按钮**: PA6 (内上拉)

---

## 🚀 软件功能说明

### 1. 自动控制逻辑 (Auto Mode)
- **温度管理**：当温度超过 **25°C** 时，舵机自动旋转至 90°（打开通风窗）。
- **湿度管理**：当湿度低于 **40%** 时，加湿器自动开启。
- **数据上报**：每 2 秒向 ESP32 推送一次完整的传感器快照。

### 2. 远程控制功能 (Web Interface)
- **模式切换**：通过 Web 按钮切换 自动/手动 模式。
- **风扇控制**：远程开启/关闭排气风扇。
- **步进电机**：支持 正转、反转（半周/180°）及 停止 操作，用于调节遮阳帘。

### 3. Web 访问
1. ESP32 启动后将连接预设 WiFi 或开启 AP 模式。
2. 在浏览器输入 ESP32 的 IP 地址即可进入控制面板。
3. 界面支持实时传感器曲线（JS 实现）与设备状态同步。

---

## 📂 目录结构

```text
.
├── stm32/                  # STM32 Keil 工程全套代码
│   ├── CORE/               # 内核文件
│   ├── HARDWARE/           # 传感器驱动 (OLED, DHT11, JW01 等)
│   ├── SYSTEM/             # 系统库 (delay, sys, usart)
│   ├── USER/               # 主逻辑 (main.c)
│   └── other/              # 扩展驱动 (Stepper, Servo)
├── esp32/                  # ESP32 Arduino 工程代码
│   ├── connect_final.ino   # 入口文件
│   ├── web_server.cpp      # Web 服务器逻辑
│   ├── html_page.cpp       # 前端页面 (HTML/JS/CSS)
│   └── stm32_comm.cpp      # 串口通信解析
└── README.md               # 项目说明文档
```

---

## 📝 开发说明

- **IDE**: Keil uVision 5 (STM32), Arduino IDE (ESP32)
- **编译选项**: STM32 端请务必开启 **MicroLIB** 以支持 `printf`。
- **库依赖**: ESP32 端需安装 `WiFi` 和 `WebServer` 标准库。

---

## 📜 许可证

本项目采用 [MIT License](LICENSE) 授权。
